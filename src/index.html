<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音视频处理工具 by huanggh</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-header">
        <h1 class="app-title">🎵 音视频处理工具 by huanggh</h1>
    </div>

    <div class="main-container">
        <div class="container">
            <!-- 左侧文件列表 -->
            <div class="left-panel">
                <div class="folder-selection">
                    <button id="select-folder-btn" class="btn btn-primary">📂 选择文件夹</button>
                    <div id="folder-path" class="folder-path"></div>
                </div>
                
                <div class="file-tabs">
                    <button class="file-tab active" data-type="mp3">🎵 MP3压缩</button>
                    <button class="file-tab" data-type="video">🎬 视频转m3u8</button>
                    <button class="file-tab" data-type="compose">🎭 视频合成和压缩</button>
                    <button class="file-tab" data-type="intro-outro">🎬 视频片头片尾处理</button>
                </div>
                
                <div class="compose-tip" style="display: none;">
                    <div class="tip-content">
                        <span class="tip-icon">💡</span>
                        <span class="tip-text">可拖拽视频调整合成顺序</span>
                    </div>
                </div>

                <div class="file-list-header">
                    <div class="header-order" style="display: none;">序号</div>
                    <div class="header-select">
                        <input type="checkbox" id="selectAllCheckbox" title="全选/取消全选">
                    </div>
                    <div class="header-name resizable-column" data-column="name" title="悬停在右边界可拖动调整列宽">
                        名称
                        <div class="column-resizer" title="⟷ 拖动调整列宽"></div>
                    </div>
                    <div class="header-info">信息</div>
                    <div class="header-size">大小</div>
                </div>

                <div id="fileList" class="file-list">
                    <div class="empty-state">
                        <p>请选择文件夹扫描媒体文件</p>
                    </div>
                </div>

                <div class="bottom-bar">
                    <div class="file-count">
                        <span id="file-count-text">未选择文件</span>
                    </div>
                    <div class="action-buttons">
                        <button id="removeSelectedBtn" class="btn btn-danger" disabled>🗑️ 移除选中</button>
                        <button id="processBtn" class="btn btn-success" disabled>🚀 开始处理</button>
                    </div>
                </div>
            </div>

            <!-- 右侧设置面板 -->
            <div class="right-panel">
                <div class="config-header">
                    <h3 id="config-title">MP3压缩配置</h3>
                </div>

                <!-- MP3处理设置 -->
                <div id="mp3-settings" class="tab-content active">
                    <h4>MP3压缩设置</h4>
                    <div class="setting-group">
                        <label for="mp3-bitrate">目标比特率：</label>
                        <select id="mp3-bitrate">
                            <option value="32">32 kbps</option>
                            <option value="64" selected>64 kbps</option>
                            <option value="96">96 kbps</option>
                            <option value="128">128 kbps</option>
                        </select>
                    </div>
                    <div class="setting-group inline">
                        <label>编码模式：</label>
                        <div class="radio-group">
                            <label><input type="radio" name="encoding-mode" value="abr" checked> 平均 (ABR)</label>
                            <label><input type="radio" name="encoding-mode" value="cbr"> 恒定 (CBR)</label>
                        </div>
                    </div>
                    <div class="setting-group inline">
                        <label>强制处理所有文件：</label>
                        <div class="radio-group">
                            <label><input type="radio" name="force-process" value="no" checked> 否</label>
                            <label><input type="radio" name="force-process" value="yes"> 是</label>
                        </div>
                    </div>
                    <div id="mp3-threshold-group" class="setting-group">
                        <label for="mp3-threshold">比特率阈值(只处理高于此比特率的文件)：</label>
                        <select id="mp3-threshold">
                            <option value="64" selected>64 kbps</option>
                            <option value="96">96 kbps</option>
                            <option value="128">128 kbps</option>
                            <option value="192">192 kbps</option>
                            <option value="256">256 kbps</option>
                            <option value="320">320 kbps</option>
                        </select>
                        <span class="help-text">少于等于该阈值的文件不处理</span>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="mp3-keep-structure" checked>
                            保持文件夹结构
                        </label>
                    </div>
                </div>

                <!-- 视频处理设置 -->
                <div id="video-settings" class="tab-content">
                    <h4>视频处理设置</h4>
                    <div class="setting-group">
                        <label for="lesson-name">课程名称：</label>
                        <input type="text" id="lesson-name" placeholder="例如：lesson2">
                    </div>
                    <div class="setting-group">
                        <label for="video-resolution">输出分辨率：</label>
                        <select id="video-resolution">
                            <option value="720p">720p (1280x720)</option>
                            <option value="1080p" selected>1080p (1920x1080)</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="video-bitrate">视频比特率：</label>
                        <select id="video-bitrate">
                            <option value="1000">1000k</option>
                            <option value="2000" selected>2000k</option>
                            <option value="3000">3000k</option>
                            <option value="5000">5000k</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="segment-duration">HLS片段时长（秒）：</label>
                        <input type="number" id="segment-duration" value="10" min="5" max="30">
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="video-rename" checked>
                            重命名为标准格式
                        </label>
                    </div>
                </div>

                <!-- 视频合成设置 -->
                <div id="compose-settings" class="tab-content">
                    <h4>视频合成设置</h4>
                    <div class="setting-group">
                        <label for="compose-type">合成类型：</label>
                        <select id="compose-type">
                            <option value="concat">顺序拼接（推荐）</option>
                            <option value="sidebyside">并排显示（需要2个视频）</option>
                            <option value="pip">画中画（需要2个视频）</option>
                        </select>
                        <span class="help-text">顺序拼接：视频按选择顺序依次播放</span>
                    </div>
                    


                    <div class="setting-group">
                        <label for="compose-format">输出格式：</label>
                        <select id="compose-format">
                            <option value="mp4" selected>MP4 (推荐，兼容性最好)</option>
                            <option value="avi">AVI (Windows兼容)</option>
                            <option value="mkv">MKV (高质量)</option>
                            <option value="wmv">WMV (Windows Media)</option>
                            <option value="mov">MOV (QuickTime)</option>
                        </select>
                        <span class="help-text">不同格式适用于不同场景和播放设备</span>
                    </div>

                    <div class="setting-group">
                        <label for="compose-resolution">输出分辨率：</label>
                        <select id="compose-resolution">
                            <option value="auto" selected>自动（使用最高分辨率）</option>
                            <option value="4k">4K (3840x2160)</option>
                            <option value="2k">2K (2560x1440)</option>
                            <option value="1080p">1080p (1920x1080)</option>
                            <option value="720p">720p (1280x720)</option>
                            <option value="480p">480p (854x480)</option>
                            <option value="custom">自定义分辨率</option>
                        </select>
                    </div>

                    <div class="setting-group" id="custom-resolution-group" style="display: none;">
                        <label>自定义分辨率：</label>
                        <div class="resolution-input-group">
                            <div class="input-with-label">
                                <label for="custom-width">宽度:</label>
                                <input type="number" id="custom-width" min="320" max="7680" value="1920" placeholder="1920">
                                <span class="unit">px</span>
                            </div>
                            <span class="resolution-separator">×</span>
                            <div class="input-with-label">
                                <label for="custom-height">高度:</label>
                                <input type="number" id="custom-height" min="240" max="4320" value="1080" placeholder="1080">
                                <span class="unit">px</span>
                            </div>
                        </div>
                        <span class="help-text">建议使用标准比例，如16:9 (1920×1080) 或 4:3 (1024×768)</span>
                    </div>

                    <div class="setting-group">
                        <label for="compose-aspect">宽高比处理：</label>
                        <select id="compose-aspect">
                            <option value="pad">保持比例，黑边填充</option>
                            <option value="crop">裁剪到统一比例</option>
                            <option value="stretch" selected>拉伸到统一尺寸（推荐）</option>
                        </select>
                    </div>

                    <!-- 顺序拼接专属设置 -->
                    <div id="concat-settings" class="conditional-setting">
                        <div class="setting-group">
                            <label for="compose-transition">视频过渡效果：</label>
                            <select id="compose-transition">
                                <option value="none" selected>无过渡，直接切换</option>
                                <option value="fade">淡入淡出（1秒）</option>
                                <option value="crossfade">交叉淡化（1秒）</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label for="compose-audio-concat">音频处理：</label>
                            <select id="compose-audio-concat">
                                <option value="keep" selected>保留所有视频原声</option>
                                <option value="mute">静音处理</option>
                                <option value="normalize">音量标准化</option>
                            </select>
                        </div>
                    </div>

                    <!-- 并排显示和画中画专属设置 -->
                    <div id="multi-video-settings" class="conditional-setting" style="display: none;">
                        <div class="setting-group">
                            <label for="compose-audio-multi">音频选择：</label>
                            <select id="compose-audio-multi">
                                <option value="first" selected>仅保留第一个视频音频</option>
                                <option value="second">仅保留第二个视频音频</option>
                                <option value="mix">混合两个视频音频</option>
                                <option value="mute">静音处理</option>
                            </select>
                        </div>
                        <div class="setting-group" id="pip-position" style="display: none;">
                            <label for="compose-pip-position">画中画位置：</label>
                            <select id="compose-pip-position">
                                <option value="top-right" selected>右上角</option>
                                <option value="top-left">左上角</option>
                                <option value="bottom-right">右下角</option>
                                <option value="bottom-left">左下角</option>
                            </select>
                        </div>
                        <div class="setting-group" id="pip-size" style="display: none;">
                            <label for="compose-pip-size">画中画大小：</label>
                            <select id="compose-pip-size">
                                <option value="small">小（1/6画面）</option>
                                <option value="medium" selected>中（1/4画面）</option>
                                <option value="large">大（1/3画面）</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-group" id="background-color-group" style="display: none;">
                        <label for="compose-background">背景颜色：</label>
                        <select id="compose-background">
                            <option value="black" selected>黑色</option>
                            <option value="white">白色</option>
                            <option value="blur">模糊背景</option>
                        </select>
                        <span class="help-text">仅在"保持比例，黑边填充"模式下生效</span>
                    </div>

                    <div class="setting-group">
                        <label for="compose-quality">质量预设：</label>
                        <select id="compose-quality">
                            <option value="high">高质量（文件较大，速度较慢）</option>
                            <option value="medium" selected>平衡（推荐）</option>
                            <option value="fast">快速（文件较小，质量一般）</option>
                            <option value="custom">自定义（专业设置）</option>
                        </select>
                        <span class="help-text">自定义模式可设置详细的编码参数</span>
                    </div>

                    <!-- 自定义编码参数设置 -->
                    <div id="custom-quality-group" class="conditional-setting" style="display: none;">
                        <div class="setting-group">
                            <label for="video-profile">编码规范兼容性：</label>
                            <select id="video-profile">
                                <option value="baseline">Baseline（基础兼容）</option>
                                <option value="main" selected>Main（主流兼容）</option>
                                <option value="high">High（高级特性）</option>
                            </select>
                            <span class="help-text">Baseline最兼容，High质量最好</span>
                        </div>
                        
                        <div class="setting-group">
                            <label for="video-bitrate-custom">视频比特率：</label>
                            <div class="input-with-unit">
                                <input type="number" id="video-bitrate-custom" min="500" max="20000" value="2000" step="100">
                                <span class="unit">kbps</span>
                            </div>
                            <span class="help-text">建议范围：1000-5000 kbps</span>
                        </div>

                        <div class="setting-group">
                            <label for="video-framerate-custom">视频帧率：</label>
                            <select id="video-framerate-custom">
                                <option value="24">24 fps</option>
                                <option value="25">25 fps</option>
                                <option value="30" selected>30 fps</option>
                                <option value="50">50 fps</option>
                                <option value="60">60 fps</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label for="audio-bitrate-custom">音频比特率：</label>
                            <select id="audio-bitrate-custom">
                                <option value="96">96 kbps</option>
                                <option value="128" selected>128 kbps</option>
                                <option value="192">192 kbps</option>
                                <option value="256">256 kbps</option>
                                <option value="320">320 kbps</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label for="audio-samplerate">音频采样率：</label>
                            <select id="audio-samplerate">
                                <option value="44100" selected>44.1 kHz（CD质量）</option>
                                <option value="48000">48 kHz（DVD质量）</option>
                                <option value="96000">96 kHz（高保真）</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label for="encode-preset">编码预设：</label>
                            <select id="encode-preset">
                                <option value="ultrafast">Ultrafast（最快编码）</option>
                                <option value="superfast">Superfast（超快编码）</option>
                                <option value="veryfast">Veryfast（很快编码）</option>
                                <option value="faster">Faster（较快编码）</option>
                                <option value="fast">Fast（快速编码）</option>
                                <option value="medium" selected>Medium（平衡）</option>
                                <option value="slow">Slow（慢速高质量）</option>
                                <option value="slower">Slower（更慢更高质量）</option>
                                <option value="veryslow">Veryslow（最慢最高质量）</option>
                            </select>
                            <span class="help-text">速度越慢，压缩效率越高，文件越小</span>
                        </div>
                    </div>
                </div>

                <!-- 视频片头片尾处理设置 -->
                <div id="intro-outro-settings" class="tab-content">
                    <h4>视频片头片尾处理设置</h4>
                    
                    <!-- 片头处理设置 -->
                    <div class="setting-group">
                        <h5>🎬 片头处理</h5>
                        <div class="setting-group inline">
                            <label>替换片头：</label>
                            <div class="radio-group">
                                <label><input type="radio" name="replace-intro" value="no" checked> 否</label>
                                <label><input type="radio" name="replace-intro" value="yes"> 是</label>
                            </div>
                        </div>
                        <div class="setting-group" id="intro-file-group" style="display: none;">
                          <label for="intro-file">新片头视频文件：</label>
                          <div class="file-input-group">
                              <input type="text" id="intro-file" placeholder="选择片头视频文件" readonly>
                              <button id="select-intro-btn" class="btn btn-secondary">选择文件</button>
                          </div>
                          <span class="help-text">支持 MP4、AVI、MOV 等常见视频格式</span>
                      </div>
                        
                        <div class="setting-group" id="intro-trim-group">
                            <label for="intro-trim-seconds">去除片头时长（秒）：</label>
                            <div class="input-with-unit">
                                <input type="number" id="intro-trim-seconds" min="0" max="300" value="0" step="0.01">
                                <span class="unit">秒</span>
                            </div>
                            <span class="help-text">从视频开头裁剪掉指定秒数（支持小数，如1.23秒）</span>
                        </div>
                        
                        
                    </div>
                    
                    <!-- 片尾处理设置 -->
                    <div class="setting-group">
                        <h5>🎭 片尾处理</h5>
                        <div class="setting-group inline">
                            <label>替换片尾：</label>
                            <div class="radio-group">
                                <label><input type="radio" name="replace-outro" value="no" checked> 否</label>
                                <label><input type="radio" name="replace-outro" value="yes"> 是</label>
                            </div>
                        </div>
                        <div class="setting-group" id="outro-file-group" style="display: none;">
                          <label for="outro-file">新片尾视频文件：</label>
                          <div class="file-input-group">
                              <input type="text" id="outro-file" placeholder="选择片尾视频文件" readonly>
                              <button id="select-outro-btn" class="btn btn-secondary">选择文件</button>
                          </div>
                          <span class="help-text">支持 MP4、AVI、MOV 等常见视频格式</span>
                      </div>
                        
                        <div class="setting-group" id="outro-trim-group">
                            <label for="outro-trim-seconds">去除片尾时长（秒）：</label>
                            <div class="input-with-unit">
                                <input type="number" id="outro-trim-seconds" min="0" max="300" value="0" step="0.01">
                                <span class="unit">秒</span>
                            </div>
                            <span class="help-text">从视频结尾裁剪掉指定秒数（支持小数，如1.23秒）</span>
                        </div>
                        
                        
                    </div>
                    
                    <!-- 裁剪汇总 -->
                    <div class="setting-group">
                        <div class="trim-summary" id="trim-summary">
                            <div class="summary-header">📊 裁剪汇总</div>
                            <div class="summary-content">
                                <div class="summary-item">
                                    <span class="summary-label">去除片头：</span>
                                    <span class="summary-value" id="intro-trim-display">0秒</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">去除片尾：</span>
                                    <span class="summary-value" id="outro-trim-display">0秒</span>
                                </div>
                                <div class="summary-item total">
                                    <span class="summary-label">总计裁剪：</span>
                                    <span class="summary-value" id="total-trim-display">0秒</span>
                                </div>
                            </div>
                            <div class="precision-warning" id="precision-warning" style="display: none;">
                                <div class="warning-icon">⚠️</div>
                                <div class="warning-text">
                                    <strong>精度提醒</strong>：无损模式受关键帧限制，实际裁剪时间可能有偏差。如需精确裁剪，请选择"精确模式"。
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 输出设置 -->

                    <div class="setting-group">
                        <label for="intro-outro-quality">处理质量：</label>
                        <select id="intro-outro-quality">
                            <option value="quality-match" selected>智能质量匹配（推荐，精确+高质量）</option>
                            <option value="copy">快速模式（可能不精确，受关键帧限制）</option>
                            <option value="high">高质量重编码（精确，CRF18）</option>
                            <option value="medium">标准重编码（精确，CRF23）</option>
                            <option value="fast">快速重编码（精确，CRF28）</option>
                        </select>
                        <div class="help-text">
                            <div><strong>智能质量匹配</strong>：自动检测原视频参数，精确裁剪且保持高质量，推荐使用</div>
                            <div><strong>快速模式</strong>：直接裁剪，速度快但可能不精确（受关键帧限制）</div>
                            <div><strong>重编码模式</strong>：完全精确的裁剪，可选择不同质量等级（CRF值）</div>
                        </div>
                    </div>
                </div>

                <!-- 输出设置 -->
                <div class="output-settings">
                    <h4>输出设置</h4>
                    <div class="setting-group">
                        <label for="output-folder">输出文件夹：</label>
                        <div class="folder-input-group">
                            <input type="text" id="output-folder" value="" readonly>
                            <button id="select-output-btn" class="btn btn-primary">选择</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 进度和日志区域 -->
        <div class="progress-section">
            <div class="progress-header">
                <h4>处理进度</h4>
                <div class="ffmpeg-status" id="ffmpeg-status">
                    <span class="status-indicator">⚠️</span>
                    <span>检查FFmpeg状态中...</span>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill">
                        <div class="progress-glow"></div>
                    </div>
                </div>
                <div class="progress-info">
                    <span class="progress-spinner" id="progress-spinner"></span>
                    <div class="progress-text" id="progress-text">准备就绪</div>
                </div>
            </div>
            <div class="log-container">
                <div id="log-content" class="log-content">
                    <p class="log-entry info">🎵 音视频处理工具已启动</p>
                    <p class="log-entry info">💡 选择文件夹开始扫描媒体文件</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/renderer.js"></script>
</body>
</html> 